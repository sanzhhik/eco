function JsSuggestHeader(oHandler,sParams,sParser){var t=this;t.oObj=oHandler,t.sParams=sParams,t.sExp=sParser?new RegExp("["+sParser+"]+","i"):new RegExp(","),t.oLast={str:!1,arr:!1},t.oThis={str:!1,arr:!1},t.oEl={start:!1,end:!1},t.oUnfinedWords={},t.bReady=!0,t.eFocus=!0,t.aDiv=null,t.oDiv=null,t.oActive=null,t.oPointer=[],t.oPointer_default=[],t.oPointer_this="input_field",t.oObj.onblur=function(){t.eFocus=!1},t.oObj.onfocus=function(){t.eFocus||(t.eFocus=!0,setTimeout(function(){t.CheckModif("focus")},500))},t.oLast.arr=t.oObj.value.split(t.sExp),t.oLast.str=t.oLast.arr.join(":"),setTimeout(function(){t.CheckModif("this")},500),this.CheckModif=function(e){var o=!1,r=0,n=!1,i="",a={};if(t.eFocus){if(t.bReady&&t.oObj.value.length>0&&(t.oThis.arr=t.oObj.value.split(t.sExp),t.oThis.str=t.oThis.arr.join(":"),t.oThis.str&&t.oThis.str!=t.oLast.str&&(a.position=TCJsUtilsHeader.getCursorPosition(t.oObj),a.position.end>0&&!t.sExp.test(t.oObj.value.substr(a.position.end-1,1))&&(a.arr=t.oObj.value.substr(0,a.position.end).split(t.sExp),o=t.oThis.arr[a.arr.length-1],t.oEl.start=a.position.end-a.arr[a.arr.length-1].length,t.oEl.end=t.oEl.start+o.length,t.oEl.content=o,t.oLast.arr=t.oThis.arr,t.oLast.str=t.oThis.str)),o)){for(r=2;r<=o.length;r++)if(i=o.substr(0,r),"!fined"==t.oUnfinedWords[i]){n=!0;break}n||t.Send(o)}setTimeout(function(){t.CheckModif("this")},500)}},t.Send=function(sSearch){if(!sSearch)return!1;var oError=[];t.bReady=!1,BX("wait_container")&&(BX("wait_container").innerHTML=BX.message("JS_CORE_LOADING"),BX.show(BX("wait_container"))),BX.ajax.post("/bitrix/components/bitrix/search.suggest.input/search.php",{search:sSearch,params:t.sParams},function(data){var result={};t.bReady=!0;try{eval("result = "+data+";")}catch(t){oError.result_unval=t}TCJsUtilsHeader.empty(result)&&(oError.result_empty="Empty result");try{if(TCJsUtilsHeader.empty(oError)&&"object"==typeof result){if(1!=result.length||result[0].NAME!=t.oEl.content)return void t.Show(result)}else t.oUnfinedWords[t.oEl.content]="!fined"}catch(t){oError.unknown_error=t}BX("wait_container")&&BX.hide(BX("wait_container"))})},t.Show=function(e){t.Destroy(),t.oDiv=document.body.appendChild(document.createElement("DIV")),t.oDiv.id=t.oObj.id+"_div",t.oDiv.className="search-popup",t.oDiv.style.position="absolute",t.aDiv=t.Print(e);var o=TCJsUtilsHeader.GetRealPos(t.oObj);t.oDiv.style.width=parseInt(o.width)+"px",TCJsUtilsHeader.show(t.oDiv,o.left,o.bottom),TCJsUtilsHeader.addEvent(document,"click",t.CheckMouse),TCJsUtilsHeader.addEvent(document,"keydown",t.CheckKeyword)},t.Print=function(e){var o=null,r={},n=0,i=null,a=null,s=t.oDiv.id;for(var l in e)if(e.hasOwnProperty(l)){o=e[l];var c={};c.ID=o.ID&&o.ID.length>0?o.ID:n++,c.GID=s+"_"+c.ID,c.NAME=TCJsUtilsHeader.htmlspecialcharsEx(o.NAME),c.CNT=o.CNT,r[c.GID]=c,t.oPointer.push(c.GID),(i=t.oDiv.appendChild(document.createElement("DIV"))).id=c.GID,i.name=s+"_div",i.className="search-popup-row",i.onmouseover=function(){t.Init(),this.className="search-popup-row-active"},i.onmouseout=function(){t.Init(),this.className="search-popup-row"},i.onclick=function(){t.oActive=this.id},(a=i.appendChild(document.createElement("DIV"))).id=i.id+"_NAME",a.className="search-popup-el search-popup-el-cnt",a.innerHTML=c.CNT,(a=i.appendChild(document.createElement("DIV"))).id=i.id+"_NAME",a.className="search-popup-el search-popup-el-name",a.innerHTML=c.NAME}return t.oPointer.push("input_field"),t.oPointer_default=t.oPointer,r},t.Destroy=function(){try{TCJsUtilsHeader.hide(t.oDiv),t.oDiv.parentNode.removeChild(t.oDiv)}catch(t){}t.aDiv=[],t.oPointer=[],t.oPointer_default=[],t.oPointer_this="input_field",t.bReady=!0,t.eFocus=!0,t.oActive=null,TCJsUtilsHeader.removeEvent(document,"click",t.CheckMouse),TCJsUtilsHeader.removeEvent(document,"keydown",t.CheckKeyword)},t.Replace=function(){if("string"==typeof t.oActive){var e=t.aDiv[t.oActive],o="";if("object"==typeof e){var r=document.createElement("span");r.innerHTML=e.NAME.replace(/&quot;/g,'"').replace(/&amp;/g,"&"),o=r.innerHTML}for(var n=t.oEl.start;n<t.oObj.value.length&&" "==t.oObj.value.substring(n,n+1);)n++;t.oObj.value=t.oObj.value.substring(0,n)+o.replace(/&lt;/g,"<").replace(/&gt;/g,">")+t.oObj.value.substr(t.oEl.end),TCJsUtilsHeader.setCursorPosition(t.oObj,n+o.length)}},t.Init=function(){t.oActive=!1,t.oPointer=t.oPointer_default,t.Clear(),t.oPointer_this="input_pointer"},t.Clear=function(){var e=t.oDiv.getElementsByTagName("div");if(e.length>0&&"object"==typeof e)for(var o in e)if(e.hasOwnProperty(o)){var r=e[o];r&&"object"==typeof r&&r.name==t.oDiv.id+"_div"&&(r.className="search-popup-row")}},t.CheckMouse=function(){t.Replace(),t.Destroy()},t.CheckKeyword=function(e){e||(e=window.event);var o=null,r=null;if(37<e.keyCode&&e.keyCode<41||13==e.keyCode){switch(t.Clear(),e.keyCode){case 38:o=t.oPointer.pop(),t.oPointer_this==o&&(t.oPointer.unshift(o),o=t.oPointer.pop()),"input_field"!=o&&(t.oActive=o,"object"==typeof(r=document.getElementById(o))&&(r.className="search-popup-row-active")),t.oPointer.unshift(o);break;case 40:o=t.oPointer.shift(),t.oPointer_this==o&&(t.oPointer.push(o),o=t.oPointer.shift()),"input_field"!=o&&(t.oActive=o,"object"==typeof(r=document.getElementById(o))&&(r.className="search-popup-row-active")),t.oPointer.push(o);break;case 39:case 13:t.Replace(),t.Destroy()}t.oPointer_this=o}else t.Destroy()}}var TCJsUtilsHeader={arEvents:[],addEvent:function(t,e,o){t.attachEvent?t.attachEvent("on"+e,o):t.addEventListener?t.addEventListener(e,o,!1):t["on"+e]=o,this.arEvents[this.arEvents.length]={element:t,event:e,fn:o}},removeEvent:function(t,e,o){t.detachEvent?t.detachEvent("on"+e,o):t.removeEventListener?t.removeEventListener(e,o,!1):t["on"+e]=null},getCursorPosition:function(t){var e={start:0,end:0};if(!t||"object"!=typeof t)return e;try{if(null!=document.selection&&null==t.selectionStart){t.focus();for(var o=document.selection.createRange(),r=o.parentElement(),n=o.getBookmark(),i=t.value,a=t.value,s="__"+Math.random()+"__";-1!=i.indexOf(s);)s="__"+Math.random()+"__";return!r||null==r||"textarea"!=r.type&&"text"!=r.type?e:(o.text=s+o.text+s,i=t.value,e.start=i.indexOf(s),i=i.replace(s,""),e.end=i.indexOf(s),t.value=a,o.moveToBookmark(n),o.select(),e)}return{start:t.selectionStart,end:t.selectionEnd}}catch(t){}return e},setCursorPosition:function(t,e){if("object"!=typeof t)return!1;t.focus();try{if(null!=document.selection&&null==t.selectionStart)document.selection.createRange().select();else t.selectionStart=e,t.selectionEnd=e;return!0}catch(t){return!1}},printArray:function(t,e,o){try{var r="",n="";void 0==o&&(o=0),e||(e="\n");for(var i=0;i<=o;i++)n+="  ";for(var a in t)t.hasOwnProperty(a)&&("object"==typeof t[a]?r+=n+a+" = {"+e+TCJsUtilsHeader.printArray(t[a],e,o+1)+", "+e+"}"+e:r+=n+a+" = "+t[a]+"; "+e);return r}catch(t){}},empty:function(t){var e=!0;if(t)for(var o in t)if(t.hasOwnProperty(o)){e=!1;break}return e},show:function(t,e,o){if("object"==typeof t){var r=parseInt(t.style.zIndex);return(r<=0||isNaN(r))&&(r=100),t.style.zIndex=r,t.style.left=e+"px",t.style.top=o+"px",t}},hide:function(t){t&&(t.style.display="none")},GetRealPos:function(t){if(t&&t.parentNode&&(t=t.parentNode.parentNode),!t||!t.offsetParent)return!1;var e={},o=t.offsetParent;for(e.left=t.offsetLeft,e.top=t.offsetTop;o&&"BODY"!=o.tagName;)e.left+=o.offsetLeft,e.top+=o.offsetTop,o=o.offsetParent;return e.right=e.left+t.offsetWidth,e.bottom=e.top+t.offsetHeight,e.width=t.offsetWidth,e.height=t.offsetHeight,e},htmlspecialcharsEx:function(t){return t.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},htmlspecialcharsback:function(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}};