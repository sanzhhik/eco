"use strict";function RSFlyingCart(t){this.id=t.ID,this.$cart=$("#"+this.id),this.$content=this.$cart.find(".flying-cart__content"),this.$btn=this.$cart.find(".flying-cart__icon"),this.templateName=t.TEMPLATE_NAME,this.arParams=t.TEMPLATE_PARAMS,this.ajaxPath=t.AJAX_PATH,this.siteId=t.SITE_ID,this.resize(),BX.addCustomEvent("add2basket.rs_lightbasket",$.proxy(this.add2cart,this)),BX.addCustomEvent("clear.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("delete.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("update.rs_lightbasket",$.proxy(this.refresh,this)),this.$btn.on("click",$.proxy(this.openPopup,this)),$(window).on("resize.flycart",BX.debounce($.proxy(this.resize,this),250)),this.initContentEvents()}RSFlyingCart.prototype.initContentEvents=function(){this.$content.find(".product-item-amount .dropdown-menu > li").on("click",this.changeQuantity),this.$content.find(".product-item-amount-field").on("change",$.proxy(this.updateQuantity,this)),this.$content.find(".dropdown").on("show.bs.dropdown",$.proxy(this.quantityDropdownPosition,this)),this.$content.find(".js-cart__remove").on("click",$.proxy(function(t){t.preventDefault(),this.startLoader();var i=$(t.target).closest("[data-id]").data("id");Basket.delete(i)},this)),this.$content.find(".js-cart__clear").on("click",$.proxy(function(){this.startLoader(),Basket.clear()},this))},RSFlyingCart.prototype.refresh=function(){this.startLoader(),BX.ajax({url:this.ajaxPath,method:"POST",dataType:"json",data:{action:"get",sessid:BX.bitrix_sessid(),templateName:this.templateName,arParams:this.arParams,siteId:this.siteId},onsuccess:function(t){this.$content.html(t.CONTENT),this.updateCount(t.COUNT),this.hideOrShow(),this.isShown()&&(this.$cart.css("transition","0s").css("height",this.$content.outerHeight()),setTimeout($.proxy(function(){this.$cart.css("transition","")},this),0)),this.initContentEvents(),this.endLoader()}.bind(this)})},RSFlyingCart.prototype.hideOrShow=function(){RS.Application().inBreakpoint("xs")&&Basket&&Basket.inbasket().length>0?this.$cart.show():this.isShown()||this.$cart.hide()},RSFlyingCart.prototype.resize=function(){this.hideOrShow(),this.position()},RSFlyingCart.prototype.position=function(){var t=$("<div>").addClass("container").css("visibility","hidden");$("body").append(t);var i=t.outerWidth(),s=t.offset().left+i,o=$(window).outerWidth();this.$cart.css("right",o>s+95?o-s-95:15),t.remove()},RSFlyingCart.prototype.openPopup=function(){if(RS.Application().inBreakpoint("sm")){var t=this;this.$cart.css("height",this.$content.outerHeight()).css("top",this.$cart.offset().top).css("position","absolute").addClass("is-open"),$("body").append('<div class="fancybox-container fancybox-is-open"><div class="fancybox-bg"></div></div>'),this.$cart.trigger("open.rs.flying_cart");var i=function(i){i.preventDefault(),t.closePopup(),$(".fancybox-container").off("click.close-cart"),t.$cart.off("click.close-cart")};$(".fancybox-container").on("click.close-cart",i),this.$cart.on("click.close-cart",".js-cart-close",i),$(document).on("keyup.cart_escape",$.proxy(function(t){27===t.keyCode&&i(t)},this))}else window.location.href=this.arParams.PATH_TO_CART},RSFlyingCart.prototype.closePopup=function(){this.$cart.css("height","").css("top","").css("position","").removeClass("is-open"),$(".fancybox-container").remove(),$(this.$cart).trigger("close.rs.flying_cart"),$(document).off("keyup.cart_escape")},RSFlyingCart.prototype.changeQuantity=function(){var t=$(this);t.hasClass("product-item-amount-var")?t.closest(".product-item-amount").find(".product-item-amount-field").val(t.text()).change():t.closest(".product-item-amount").find(".product-item-amount-field").val("").focus()},RSFlyingCart.prototype.updateQuantity=function(t){this.startLoader();var i=$(t.target),s=parseFloat(i.val(),10),o=i.closest("[data-id]").data("id");$.Deferred(),Basket.updateQuantity(o,s)},RSFlyingCart.prototype.updateCount=function(t){this.$btn.find(".flying-cart__count").html(t),$(".js-mobile-cart-icon").html(t)},RSFlyingCart.prototype.quantityDropdownPosition=function(t){var i=this.$content.find(".js-cart__products").scrollTop(),s=$(t.target);s.find(".dropdown-menu").css("margin-top",2-i),this.$content.find(".js-cart__products").one("scroll.dropdown",function(){s.removeClass("open")})},RSFlyingCart.prototype.isShown=function(){return this.$cart.hasClass("is-open")},RSFlyingCart.prototype.startLoader=function(){this.$cart.addClass("is-loading")},RSFlyingCart.prototype.endLoader=function(){this.$cart.removeClass("is-loading")},RSFlyingCart.prototype.add2cart=function(){this.$cart.addClass("in-cart-animation"),setTimeout($.proxy(function(){this.$cart.removeClass("in-cart-animation")},this),500),this.refresh()};